<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
		
		<title></title>
		<link rel="stylesheet" type="text/css" href="css/index.css"/>
		<script type="text/javascript" src="js/transformCss.js"></script>
		<script type="text/javascript" src="js/drag.js"></script>
	</head>
	
	<body>
		<div id="wrap">
			<div id="header">
				<div id="headerTop">
					<div id="logo">
						<h1><a href="#"><img src="img/logo.png"/></a></h1>
					</div>
					
					<a href="#" id="menuBtn" class="menuBtnClos"></a>
					<div id="navs">
						<a href="https://www.baidu.com/" id="searchBtn">搜索</a>
						<a href="">登录</a>
						<a href="">注册</a>
					</div>
				</div>
			<form  id="search">
				<input type="text" placeholder="请输入搜索内容" />
				<input type="submit" value="搜索"/>
			</form>	
			<ul id="mark">
				    <li>
						<a href="javascript:;">首页</a>
					</li>
					<li>
						<a href="javascript:;">MV</a>
					</li>
					<li>
						<a href="javascript:;">悦单</a>
					</li>
					<li>
						<a href="javascript:;">V榜</a>
					</li>
					<li>
						<a href="javascript:;">音悦</a>
					</li>
					<li>
						<a href="javascript:;">商城</a>
					</li>
					<li>
						<a href="javascript:;">节目</a>
					</li>
					<li>
						<a href="javascript:;">饭团</a>
					</li>
					<li>
						<a href="javascript:;">资讯</a>
					</li>
					<li>
						<a href="javascript:;">我的家</a>
					</li>
					<li>
						<a href="javascript:;">APP下载</a>
					</li>
					<li>
						<a href="javascript:;">热门应用</a>
					</li>
			</ul>	
			</div>
			<div id="conWrap">
				<div id="content">
					<div id="navsWrap">
						<ul id="navsList">
						    <li class="active">
								<a href="javascript:;">首页</a>
							</li>
							<li>
								<a href="javascript:;">MV</a>
							</li>
							<li>
								<a href="javascript:;">悦单</a>
							</li>
							<li>
								<a href="javascript:;">V榜</a>
							</li>
							<li>
								<a href="javascript:;">音悦</a>
							</li>
							<li>
								<a href="javascript:;">商城</a>
							</li>
							<li>
								<a href="javascript:;">节目</a>
							</li>
							<li>
								<a href="javascript:;">饭团</a>
							</li>
							<li>
								<a href="javascript:;">资讯</a>
							</li>
							<li>
								<a href="javascript:;">我的家</a>
							</li>
							<li>
								<a href="javascript:;">APP下载</a>
							</li>
							<li>
								<a href="javascript:;">热门应用</a>
							</li>
					    </ul>	
					</div>
					
					
					<div id="ban_wrap">
						<ul id="ban_list">
							<li>
								<a href="###">
									<img src="imgs/1.jpg"/>
								</a>
							</li>
							<li>
								<a href="###">
									<img src="imgs/2.jpg"/>
								</a>
							</li>
							<li>
								<a href="###">
									<img src="imgs/3.jpg"/>
								</a>
							</li>
							<li>
								<a href="###">
									<img src="imgs/4.jpg"/>
								</a>
							</li>
							<li>
								<a href="###">
									<img src="imgs/5.jpg"/>
								</a>
							</li>
						</ul>
						<div id="ban_nav">
							<span class="ban_active"></span>
							<span></span>
							<span></span>
							<span></span>
							<span></span>
						</div>
					</div>
				
					<div class="tab">
						<div class="tab_header">
							<h2>MV首播</h2>
							<a href="#">更多&gt;</a>
						</div>
						
						<nav class="tab_nav">
							<a href="#">全部</a>
							<a href="#">内地</a>
							<a href="#">港台</a>
							<a href="#">欧美</a>
							<a href="#">韩国</a>
							<a href="#">日本</a>
							<span class="smallG"></span>
						</nav>
						
						<div class="tab_wrap">
							<ul class="tab_loading"></ul>
							<ul class="tab_list">
								<li>
									<img src="imgs/a.jpg"/>
									<span>君に贈る花がない</span>
									<div class="ice">
										<div class="ice_left">
											<span class="ice_pic"></span>
											<span>9196</span>
										</div>
										<div class="ice_right">
											<span class="ice_pic"></span>
											<span>9</span>
										</div>
									</div>
								</li>
								<li>
									<img src="imgs/b.jpg"/>
									<span>君に贈る花がない</span>
									<div class="ice">
										<div class="ice_left">
											<span class="ice_pic"></span>
											<span>9196</span>
										</div>
										<div class="ice_right">
											<span class="ice_pic"></span>
											<span>9</span>
										</div>
									</div>
								</li>
								<li>
									<img src="imgs/c.jpg"/>
									<span>君に贈る花がない</span>
									<div class="ice">
										<div class="ice_left">
											<span class="ice_pic"></span>
											<span>9196</span>
										</div>
										<div class="ice_right">
											<span class="ice_pic"></span>
											<span>9</span>
										</div>
									</div>
								</li>
								<li>
									<img src="imgs/d.jpg"/>
									<span>君に贈る花がない</span>
									<div class="ice">
										<div class="ice_left">
											<span class="ice_pic"></span>
											<span>9196</span>
										</div>
										<div class="ice_right">
											<span class="ice_pic"></span>
											<span>9</span>
										</div>
									</div>
								</li>
								<li>
									<img src="imgs/e.jpg"/>
									<span>君に贈る花がない</span>
									<div class="ice">
										<div class="ice_left">
											<span class="ice_pic"></span>
											<span>9196</span>
										</div>
										<div class="ice_right">
											<span class="ice_pic"></span>
											<span>9</span>
										</div>
									</div>
								</li>
								<li>
									<img src="imgs/f.jpg"/>
									<span>君に贈る花がない</span>
									<div class="ice">
										<div class="ice_left">
											<span class="ice_pic"></span>
											<span>9196</span>
										</div>
										<div class="ice_right">
											<span class="ice_pic"></span>
											<span>9</span>
										</div>
									</div>
								</li>
							</ul>
							
							
							<ul class="tab_loading"></ul>
							
						</div>
			
					</div>
					
					<div class="tab">
						<div class="tab_header">
							<h2>MV首播</h2>
							<a href="#">更多&gt;</a>
						</div>
						
						<nav class="tab_nav">
							<a href="#">全部</a>
							<a href="#">内地</a>
							<a href="#">港台</a>
							<a href="#">欧美</a>
							<a href="#">韩国</a>
							<a href="#">日本</a>
							<span class="smallG"></span>
						</nav>
						
						<div class="tab_wrap">
							<ul class="tab_loading"></ul>
							<ul class="tab_list">
								<li>
									<img src="imgs/a.jpg"/>
									<span>君に贈る花がない</span>
									<div class="ice">
										<div class="ice_left">
											<span class="ice_pic"></span>
											<span>9196</span>
										</div>
										<div class="ice_right">
											<span class="ice_pic"></span>
											<span>9</span>
										</div>
									</div>
								</li>
								<li>
									<img src="imgs/b.jpg"/>
									<span>君に贈る花がない</span>
									<div class="ice">
										<div class="ice_left">
											<span class="ice_pic"></span>
											<span>9196</span>
										</div>
										<div class="ice_right">
											<span class="ice_pic"></span>
											<span>9</span>
										</div>
									</div>
								</li>
								<li>
									<img src="imgs/c.jpg"/>
									<span>君に贈る花がない</span>
									<div class="ice">
										<div class="ice_left">
											<span class="ice_pic"></span>
											<span>9196</span>
										</div>
										<div class="ice_right">
											<span class="ice_pic"></span>
											<span>9</span>
										</div>
									</div>
								</li>
								<li>
									<img src="imgs/d.jpg"/>
									<span>君に贈る花がない</span>
									<div class="ice">
										<div class="ice_left">
											<span class="ice_pic"></span>
											<span>9196</span>
										</div>
										<div class="ice_right">
											<span class="ice_pic"></span>
											<span>9</span>
										</div>
									</div>
								</li>
								<li>
									<img src="imgs/e.jpg"/>
									<span>君に贈る花がない</span>
									<div class="ice">
										<div class="ice_left">
											<span class="ice_pic"></span>
											<span>9196</span>
										</div>
										<div class="ice_right">
											<span class="ice_pic"></span>
											<span>9</span>
										</div>
									</div>
								</li>
								<li>
									<img src="imgs/f.jpg"/>
									<span>君に贈る花がない</span>
									<div class="ice">
										<div class="ice_left">
											<span class="ice_pic"></span>
											<span>9196</span>
										</div>
										<div class="ice_right">
											<span class="ice_pic"></span>
											<span>9</span>
										</div>
									</div>
								</li>
							</ul>
							
							
							<ul class="tab_loading"></ul>
							
						</div>
			
					</div>
				
			    </div>
			
			</div>
		</div>
		
		<div id="scrollBar">
			
		</div>
		
	</body>
	<script type="text/javascript">
		
		/*document.addEventListener('touchstart',function(event){
			event.preventDefault();
		});*/
		
		var width=document.documentElement.clientWidth;
		var styleN=document.createElement('style');
		styleN.innerHTML='html{font-size: '+width/16+'px;}';
		document.head.appendChild(styleN);
		
				
		window.onload=function(){
			banner();
			tab();
			touchMenu();
			nav();
			changeColor();
			dragY();
		}
		
		function dragY(){
			var conWrap=document.getElementById('conWrap');
			var scrollBar=document.getElementById('scrollBar');
			
			var scale=document.documentElement.clientHeight/content.offsetHeight;
		    scrollBar.style.height=document.documentElement.clientHeight*scale+'px';
		    
			
			var callBack={
					start:function(){
						scrollBar.style.opacity=1;
					},
					move:function(){
						scrollBar.style.opacity=1;
						//滚动条的偏移量 = 内容偏移量 * scale
						disBar=transformCss(content,'translateY')*scale;		
						transformCss(scrollBar,'translateY',-disBar);
					},
					end:function(){
						scrollBar.style.opacity=0;	
					}
			};
			dragEvent(conWrap,callBack);
			
//			dragEvent(conWrap);
		}
		
		
		//频道按钮
		
		function touchMenu () {
			var menuBtn=document.getElementById('menuBtn');
			var wrap=document.getElementById('wrap');
			var mark=document.getElementById('mark');
			
			menuBtn.addEventListener('touchstart',function(event){
				if ( this.className=='menuBtnClos') {
					this.className='menuBtnOpen';
					mark.style.display='block';
				} else{
					this.className='menuBtnClos'
					mark.style.display='none'
				}
				event.stopPropagation();
			});
			mark.addEventListener('touchstart',function(event){
				event.stopPropagation();
			})
			
			document.addEventListener('touchstart',function(event){
				mark.style.display='none'
				menuBtn.className='menuBtnClos'
			})

		};
		
		//导航区域
		
		function nav () {
			var navList=document.getElementById('navsList');
			var navWrap=document.getElementById('navsWrap');
			
			var eleX=0;
			var startX=0;
			
			
			var beginU=0;
			var beginTime=0;
			var endU=0;
			var endTime=0;
			var disU=0;
			var disTime=1;//disU=0;
			
		
			
			navWrap.addEventListener('touchstart',function  (event) {
				var touch=event.changedTouches[0];
				navList.style.transition='none'
				startX=touch.clientX;
				eleX=transformCss(navList,'translateX');
				console.log(eleX)
				beginU=eleX;
			    beginTime=new Date().getTime();
			    
			    
			    disU=0;//不然一上来先点击在不能滑动
			});
			
			navWrap.addEventListener('touchmove',function(event){
				var touch=event.changedTouches[0];
				var endX=touch.clientX;
				var disX=endX-startX;
				var translateX=disX+eleX;
				
				var minX=width-navList.offsetWidth;
				var scale=0;
				if (translateX>0) {
					scale=1-translateX/width;
					translateX=translateX*scale;
				} else if(translateX<minX){
					var over=minX-translateX;
					scale=1 - over/width;
					
					translateX=minX-over*scale;
				};
				

				transformCss(navList,'translateX',translateX);
				transformCss(navList,'translateZ',0.1);
				
				endU=translateX;
				endTime=new Date().getTime();
				
				disU=endU-beginU;
				disTime=endTime-beginTime;
			})

			
			navWrap.addEventListener('touchend',function  (event) {
				var touch=event.changedTouches[0];
				var speed=disU/disTime;
				var target=transformCss(navList,'translateX')+speed*200;
				var minX=width-navList.offsetWidth;
				//范围限定，橡皮筋回弹
				var bezier='';
				if (target>0) {
					target=0;
					bezier= 'cubic-bezier(0,1.79,1,.85)';
				} else if(target<minX){
					target=minX;
					bezier= 'cubic-bezier(0,1.79,1,.85)';
				}
				navList.style.transition='1s '+bezier;
 			    transformCss(navList,'translateX',target);
			})

		};
		
		//小圆点
		
		function  changeColor() {
			var navlist=document.getElementById('navsList');
			var liNodes=document.querySelectorAll('#navsList li');
			

				for(var j=0;j<liNodes.length;j++){
					var  flag=false;
					navlist.addEventListener('touchmove',function(){
						flag=true;
					})
					
				    liNodes[j].addEventListener('touchend',function(){	
				    	
				    	if(flag==false){
				    		for(var j=0;j<liNodes.length;j++){
							liNodes[j].className='';
						}
						    this.className='active';
				    	}
				    	flag=false;
				     })	
					
			    }
	
		}
		
		

		
		//选项卡区域
		function tab () {
			var tab_wrap=document.querySelectorAll('.tab .tab_wrap');
			var tab_nav=document.querySelectorAll('.tab .tab_nav');
			var translateX=tab_nav[0].offsetWidth;
			
			for(var i=0;i<tab_wrap.length;i++){
				move(tab_wrap[i],tab_nav[i]);
			}
			
			function move(tab_wrap,tab_nav){
				transformCss(tab_wrap,'translateX',-translateX);
				transformCss(tab_wrap,'translateZ',0.01);
				transformCss(tab_nav,'translateZ',0.01);
				
				var eleX=0;
				var startX=0;
				var startY=0;
				var disX=0;
				var disY=0;
				
				var isX=true;
				var isFirst=true;
				var isLoad=false;
				var loadings=tab_wrap.querySelectorAll('.tab_loading');
				
				var aNodes=tab_nav.querySelectorAll('a');
				var smallG=tab_nav.querySelector('.smallG');
				
				var indexG=0;
				
				//触摸
				tab_wrap.addEventListener('touchstart',function  (event) {
					event=event||window.event;
					if (isLoad) {
						return;
					}
					
					tab_wrap.style.transition='none'
					var touch=event.changedTouches[0];
					startX=touch.clientX;
					startY=touch.clientY;
					
					eleX=transformCss(tab_wrap,'translateX');
					
					
					
					isFirst=true;
					isX=true;
				})//start
				
				tab_wrap.addEventListener('touchmove',function  (event) {
					var touch=event.changedTouches[0];
					if (isLoad) {
						return;
					}
					
					if (isX==false) {
						return;
					}
					
					var endX=touch.clientX;
					var endY=touch.clientY;
					disX=endX-startX;
					disY=endY-startY;
						
					if(isFirst){
						isFirst=false;
						if(Math.abs(disY)>Math.abs(disX)){
						   isX=false;
						   return;
					    }
					}

					transformCss(tab_wrap,'translateX',disX+eleX);
					
					//划过1/2
					if (Math.abs(disX)>translateX/2) {
						//loading可以显示了
						isLoad=true;
						var targetX=disX>0?0:-2*translateX;
						
						//小绿点
						if (disX<0) {
							indexG=indexG+1;
						} else{
							indexG=indexG-1;
						}
						if (indexG<0) {
							indexG=aNodes.length-1;
						} else if(indexG>aNodes.length-1){
							indexG=0;
						}
								
						smallG.style.transition='0.3s';
						transformCss(smallG,'translateX',aNodes[indexG].offsetLeft);
						transformCss(smallG,'translateZ',0.1);
						
						tab_wrap.style.transition='0.5s';
						transformCss(tab_wrap,'translateX',targetX);
						
						//transitionEnd检测过渡结束之后再去触发,不然不显示loading图
						tab_wrap.addEventListener('transitionEnd',fun);
						tab_wrap.addEventListener('webkitTransitionEnd',fun);
						function fun () {
							for(var i=0;i<loadings.length;i++){
								loadings[i].style.opacity='1';
							};
							setTimeout(function(){
								for(var i=0;i<loadings.length;i++){
									loadings[i].style.opacity='0';	
								};
								isLoad=false;
								tab_wrap.style.transition='0.2s'
								transformCss(tab_wrap,'translateX',-translateX);
							},2000);
							//解绑
							tab_wrap.removeEventListener('transitionEnd',fun);
							tab_wrap.removeEventListener('webkitTransitionEnd',fun);

						};
					
					};									
					
				});//touchmove
				
				tab_wrap.addEventListener('touchend',function  (event) {
					var touch=event.changedTouches[0];
					if (isLoad) {
						return;
					}
					
				
					
					if(Math.abs(disX)<translateX/2){
						tab_wrap.style.transition='0.5s';
						transformCss(tab_wrap,'translateX',-translateX);
					}
					
				});//touchend
				
				
			}//move
		};
		
		//banner区域
		function banner(){
				
					
			//获取元素
					var wrap = document.getElementById('ban_wrap');
					var list = document.getElementById('ban_list');
					transformCss(list,'translateZ',0.1);
					//动态添加li
					list.innerHTML += list.innerHTML;
					var liNodes = document.querySelectorAll('#ban_list li');
					var spanNodes = document.querySelectorAll('#ban_nav span');
					//布局
					var styleN = document.createElement('style');
					styleN.innerHTML = '#ban_list{width: '+ liNodes.length +'00%;}';
					styleN.innerHTML += '#ban_list li{width:'+ (100/liNodes.length) +'% ;}';
					styleN.innerHTML += '#ban_wrap{height: '+ liNodes[0].offsetHeight +'px;}';
					document.head.appendChild(styleN);
				
					//横向滑屏
					//定义元素和手指初始位置
					var eleX = 0;
					var startX = 0;
					var disX = 0;
					var startY=0;
					var disY=0;
					
					var isX=true;
					var isFirst=true;
					
					//定时器
					var timer = 0;
					
					//图片索引下标
					var now = 0;
					
					wrap.addEventListener('touchstart',function(event){
						var touch = event.changedTouches[0];
						
						//清除定时器
						clearInterval(timer);
						
						//清除过渡
						list.style.transition = 'none';
						
						//无缝---跳转
						var left = transformCss(list,'translateX');
						var now = Math.round(-left / document.documentElement.clientWidth);
						if(now == 0){
							now = spanNodes.length;
						}else if(now == liNodes.length-1){
							now = spanNodes.length-1;
						};
						//真正的跳转工作
						transformCss(list,'translateX',-now*document.documentElement.clientWidth);
						
						
						//元素初始位置
						//读
						eleX = transformCss(list,'translateX');
										
						//手指初始位置
						startX = touch.clientX;
						startY=touch.clientY;
						
						isFirst=true;
						isX=true;
						
					});
					wrap.addEventListener('touchmove',function(event){
						var touch = event.changedTouches[0];
						
						
						if(isX==false){
							return;
						}
						//手指结束位置
						var endX = touch.clientX;
						var endY=touch.clientY;
						//手指距离差
						disX = endX - startX;
						disY=endY-startY;
						
						if(isFirst){
							isFirst=false;
							if (Math.abs(disY)>Math.abs(disX)) {
								isX=false;
							    return;
						    }
						}
						
						
						//元素最终位置
						//写
						transformCss(list,'translateX',disX + eleX);
						
					});
					wrap.addEventListener('touchend',function(event){
						var touch = event.changedTouches[0];
						
						
						//ul偏移量
						//读
						var left = transformCss(list,'translateX');
						
						//Math.round()四舍五入
						now = Math.round(-left / document.documentElement.clientWidth);
						
						//限定now范围
						if(now<0){
							now = 0;
						}else if(now > liNodes.length-1){
							now = liNodes.length-1;
						};
						
						//过渡
						list.style.transition = '1s';
							
						//元素跳转位置
						//写
						transformCss(list,'translateX',-now * document.documentElement.clientWidth);
						
						//同步小圆点
						for(var i=0;i<spanNodes.length;i++){
							//给所有span加class
							spanNodes[i].className = '';
						};
						spanNodes[now%spanNodes.length].className = 'ban_active';
					
						//开启定时器
						auto();
					});
					
					
					//自动轮播
					//模拟now 图片索引下标
					//var now = 0;
					auto();
					function auto(){
						//优化
						clearInterval(timer);
						timer = setInterval(function(){
							//无缝
							if(now == liNodes.length-1){
								now = spanNodes.length-1;
							};
							//清除过渡
							list.style.transition = 'none';
							//跳转
							transformCss(list,'translateX',-now*document.documentElement.clientWidth);
							
							//自动播放
							setTimeout(function(){
								now++;
								list.style.transition = '0.5s';
								//写
								transformCss(list,'translateX',-now*document.documentElement.clientWidth);
							
								//同步小圆点
								for(var i=0;i<spanNodes.length;i++){
									//给所有span加class
									spanNodes[i].className = '';
								};
								spanNodes[now%spanNodes.length].className = 'ban_active';
						
							},20);
							
						},3000);
					};
					
				};
			
		
	</script>
</html>
